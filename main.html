<html>
    <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>관리 페이지</title>
        
        <style>
			* {
				margin:0px;
				padding:0px;
			}
			html , body {
				height:100%;
				background-color:aliceblue;
			}
            #div_root{
                margin:auto;
                width:inherit;
            }
            #div_input{
                width:100%;
                height: 10%;
                padding-top: 5%;
                text-align:center;
                background-color:aliceblue;
            }
            #div_list{
                width: 100%;
                height: 80%;
                text-align: center;
                background-color:aliceblue;
            }
			table {
                width: 100%;
                border-top: 1px solid #444444;
                border-collapse: collapse;
            }
            th, td {
                border-bottom: 1px, solid #444444;
                padding: 10px;
                text-align: center;
            }
            thead tr {
                background-color:cornflowerblue;
                color: #ffffff;
            }
            tbody tr:nth-child(2n) {
                background-color:aliceblue;
            }
            tbody tr:nth-child(2n+1) {
                background-color: aquamarine;
            }
            tbody td:nth-child(3) {
                padding: 10px;
                text-align: left;
            }
			tfoot tr {
				background-color:#dddddd;
				color:#ffffff;
			}
        </style>
    </head>

	<script>
		function all_check(ck) {
			var ck_all=document.getElementsByName("check");
			if (ck.checked) {
				for ( var i=0; i < ck_all.length; i++) {
					ck_all[i].checked="true";
				}
			}
			else {
				for ( var i=0; i < ck_all.length; i++) {
					ck_all[i].checked="";
				}
			}
		}

		function remove_button(bt) {
			var rm = document.getElementsByName("check");
			var aid = new Array();
			var count = 0;

			if ( bt.click ) {
				for ( var i=0; i < rm.length; i++) {
					if ( rm[i].checked ) {
						aid.push(rm[i].value);
						count++;
					}
				}
			}
			alert(aid);
			var form = document.createElement("form");
			form.setAttribute("charset","UTF-8");
            form.setAttribute("method","POST");
			form.setAttribute("action","delete.php");
		
			var hiddenField = document.createElement("input");
			hiddenField.setAttribute("type","hidden");
			hiddenField.setAttribute("name","aid");
			hiddenField.setAttribute("value",aid);
			form.appendChild(hiddenField);

			document.body.appendChild(form);
			form.submit();
		}

	</script>

    <body>
        <div id="div_input">
            <form action="http://multipledestination.online/web/upload.php" method="post" enctype="multipart/form-data">   
                <input type="file" name="upfile">
                <input type="submit">
            </form>
        </div>
        <div id="div_list">
            <?php
                $conn = mysqli_connect("localhost","eun","Abcd23@#","multiple");
                if(mysqli_connect_errno($conn)) {
                    echo "불러올 수 없습니다.";
                }
                mysqli_set_charset($conn,'utf8'); // 한글 문자 패치
				
				$candi = array(); // 기사 이름 배열 생성

				$candi_query = "select * from soongsil where position='택배기사'";
				$result_set = mysqli_query($conn, $candi_query);
				
				while($row = mysqli_fetch_array($result_set)){
					array_push($candi,$row["name"]);
				}
            ?>
            <table>
                <thead>
                    <tr><td><input type="checkbox" onchange="all_check(this);"></td><td colspan='3' >주소</td><td>분배</td></tr>
                </thead>
                <tbody>
                    <?php
                        $select_query = "SELECT * FROM soongsil_delivery";
                        $result_set = mysqli_query($conn, $select_query);
						$cnt_row = 1;
                        while($row = mysqli_fetch_array($result_set)){
							$address = $row["address"];
							$aid = $row["aid"];
                            echo "<tr>
								<td><input type='checkbox' name='check' value=$aid></td>
								<td>$aid</td>
								<td>$address</td>
								<td><input type='button' value='수정'></td><td>";
								// 후보 select
						        echo "<select name='seltest'><option value='op0' selected> </option>";
								$cnt = 0;
					            while($cnt != count($candi)) {
									echo "<option value='op$cnt'>$candi[$cnt]</option>";
									$cnt++;
								}
								$cnt_row++;
						        echo "</select></td></tr>";
                        }
						mysqli_close($conn);
                    ?>
				</tbody>
				
				<tfoot>
					<tr><td><input type="button" value="삭제" onclick="remove_button(this);"></td>
						<form action="insert.php" method="post">
						<td colspan='2'><input type="text" placeholder="Address" name="add">
							<input type="text" placeholder="Item" name="item"><br>
							<input type="text" placeholder="Phone" name="phone">
							<input type="text" placeholder="Name" name="cname">
							<input type="text" placeholder="Pay" name="pay"></td>
						<td><input type="submit" value="추가"> </td>
						</form>
						<td><input type="button" value="분배완료"</td></tr>
                </tfoot>
            </table>
        </div>
    </body>
</html>
